<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è¨˜æ†¶åŠ›å¤§è€ƒé©—</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: #f4f6fb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .game-wrapper {
      width: 100%;
      max-width: 960px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 16px 16px 24px;
    }

    .top-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      border-bottom: 1px solid #e3e6f0;
      padding-bottom: 8px;
    }

    .game-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #333;
    }

    .game-info {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      font-size: 1rem;
      align-items: center;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      background: #eef2ff;
      color: #3730a3;
    }

    #timer {
      font-weight: 700;
      color: #b91c1c;
    }

    main {
      margin-top: 8px;
    }

    .board {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      padding: 8px;
      justify-items: center;
    }

    .card {
      width: 120px;
      height: 150px;
      border-radius: 16px;
      background: #e5e7eb;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      cursor: pointer;
      position: relative;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      user-select: none;
    }

    .card.disabled {
      pointer-events: none;
      cursor: default;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .card-front,
    .card-back {
      position: absolute;
      inset: 0;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 8px;
      text-align: center;
      transition: opacity 0.2s ease;
    }

    .card-front {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      color: #fff;
      font-size: 1.8rem;
      font-weight: 600;
    }

    .card-back {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      color: #111827;
      opacity: 0;
    }

    .card.flipped .card-front {
      opacity: 0;
    }

    .card.flipped .card-back {
      opacity: 1;
    }

    .card.matched {
      background: #dcfce7;
      box-shadow: 0 0 0 2px #16a34a inset;
      cursor: default;
    }

    .card.matched .card-front {
      opacity: 0;
    }

    .card.matched .card-back {
      opacity: 1;
    }

    .emoji {
      font-size: 2.4rem;
      margin-bottom: 4px;
    }

    .label {
      font-size: 1rem;
      font-weight: 600;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .overlay.hidden {
      display: none;
    }

    .overlay-card {
      background: #ffffff;
      padding: 24px 20px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 12px 35px rgba(0,0,0,0.2);
    }

    .overlay-card h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.5rem;
    }

    .overlay-card p {
      margin: 0 0 16px;
      font-size: 1rem;
      color: #4b5563;
    }

    .overlay-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    button {
      padding: 10px 18px;
      font-size: 1rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      min-width: 120px;
    }

    .btn-primary {
      background: #4f46e5;
      color: #ffffff;
    }

    .btn-primary:hover {
      background: #4338ca;
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    @media (max-width: 600px) {
      .card {
        width: 100px;
        height: 130px;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <header class="top-bar">
      <div class="game-title">è¨˜æ†¶åŠ›å¤§è€ƒé©—</div>
      <div class="game-info">
        <span id="levelLabel" class="badge">é—œå¡ 1 / 5ï¼šæ°´æœ</span>
        <span id="timer">å‰©é¤˜æ™‚é–“ï¼š30 ç§’</span>
      </div>
    </header>
    <main>
      <div id="board" class="board"></div>
    </main>
  </div>

  <!-- èµ·å§‹ç•«é¢ -->
  <div id="startOverlay" class="overlay">
    <div class="overlay-card">
      <h2>è¨˜æ†¶åŠ›å¤§è€ƒé©—</h2>
      <p>
        ä¸€å…±æœ‰ 5 é—œï¼Œæ¯é—œé™æ™‚ 30 ç§’ã€‚<br />
        é»æ“Šå¡ç‰‡é…å°ç›¸åŒçš„åœ–æ¡ˆæˆ–è§’è‰²ã€‚
      </p>
      <button id="btnStartGame" class="btn-primary">é–‹å§‹ç¬¬ä¸€é—œï¼ˆæ°´æœï¼‰</button>
    </div>
  </div>

  <!-- çµæœ / æç¤ºç•«é¢ -->
  <div id="resultOverlay" class="overlay hidden">
    <div class="overlay-card">
      <h2 id="resultTitle">æ™‚é–“åˆ°</h2>
      <p id="resultText">å“ˆå“ˆå“ˆå‚»çœ¼</p>
      <div class="overlay-buttons">
        <button id="btnRetry" class="btn-secondary">é‡ç©æœ¬é—œ</button>
        <button id="btnNext" class="btn-primary">ä¸‹ä¸€é—œ</button>
      </div>
    </div>
  </div>

  <script>
    // ---- é—œå¡è³‡æ–™è¨­å®š ----
    const levels = [
      {
        name: "æ°´æœ",
        key: "fruit",
        items: [
          { id: "apple", emoji: "ğŸ", label: "è˜‹æœ" },
          { id: "banana", emoji: "ğŸŒ", label: "é¦™è•‰" },
          { id: "grape", emoji: "ğŸ‡", label: "è‘¡è„" },
          { id: "orange", emoji: "ğŸŠ", label: "æ©˜å­" },
          { id: "watermelon", emoji: "ğŸ‰", label: "è¥¿ç“œ" },
          { id: "pineapple", emoji: "ğŸ", label: "é³³æ¢¨" },
          { id: "strawberry", emoji: "ğŸ“", label: "è‰è“" },
          { id: "kiwi", emoji: "ğŸ¥", label: "å¥‡ç•°æœ" }
        ]
      },
      {
        name: "é£Ÿç‰©",
        key: "food",
        items: [
          { id: "bread", emoji: "ğŸ", label: "éºµåŒ…" },
          { id: "egg", emoji: "ğŸ¥š", label: "é›è›‹" },
          { id: "noodle", emoji: "ğŸœ", label: "éºµ" },
          { id: "burger", emoji: "ğŸ”", label: "æ¼¢å ¡" },
          { id: "pizza", emoji: "ğŸ•", label: "æŠ«è–©" },
          { id: "sushi", emoji: "ğŸ£", label: "å£½å¸" },
          { id: "salad", emoji: "ğŸ¥—", label: "æ²™æ‹‰" },
          { id: "cake", emoji: "ğŸ°", label: "è›‹ç³•" }
        ]
      },
      {
        name: "å®¶å…·",
        key: "furniture",
        items: [
          { id: "bed", emoji: "ğŸ›ï¸", label: "åºŠ" },
          { id: "chair", emoji: "ğŸª‘", label: "æ¤…å­" },
          { id: "sofa", emoji: "ğŸ›‹ï¸", label: "æ²™ç™¼" },
          { id: "door", emoji: "ğŸšª", label: "é–€" },
          { id: "window", emoji: "ğŸªŸ", label: "çª—æˆ¶" },
          { id: "mirror", emoji: "ğŸª", label: "é¡å­" },
          { id: "frame", emoji: "ğŸ–¼ï¸", label: "æ›ç•«" },
          { id: "lamp", emoji: "ğŸ’¡", label: "ç‡ˆ" }
        ]
      },
      {
        name: "å‹•ç‰©",
        key: "animal",
        items: [
          { id: "dog", emoji: "ğŸ¶", label: "ç‹—" },
          { id: "cat", emoji: "ğŸ±", label: "è²“" },
          { id: "pig", emoji: "ğŸ·", label: "è±¬" },
          { id: "mouse", emoji: "ğŸ­", label: "è€é¼ " },
          { id: "chicken", emoji: "ğŸ”", label: "é›" },
          { id: "horse", emoji: "ğŸ´", label: "é¦¬" },
          { id: "fish", emoji: "ğŸŸ", label: "é­š" },
          { id: "rabbit", emoji: "ğŸ°", label: "å…”å­" }
        ]
      },
      {
        name: "ç¥å¥‡å¯¶è²",
        key: "pokemon",
        items: [
          { id: "pikachu", emoji: "â­", label: "çš®å¡ä¸˜" },
          { id: "bulbasaur", emoji: "ğŸƒ", label: "å¦™è›™ç¨®å­" },
          { id: "charmander", emoji: "ğŸ”¥", label: "å°ç«é¾" },
          { id: "squirtle", emoji: "ğŸ’§", label: "å‚‘å°¼é¾œ" },
          { id: "psyduck", emoji: "ğŸ’­", label: "å¯é”é´¨" },
          { id: "eevee", emoji: "âœ¨", label: "ä¼Šå¸ƒ" },
          { id: "snorlax", emoji: "ğŸ›Œ", label: "å¡æ¯”ç¸" },
          { id: "jigglypuff", emoji: "ğŸ¤", label: "èƒ–ä¸" }
        ]
      }
    ];

    const TOTAL_TIME = 30; // æ¯é—œ 30 ç§’

    const boardEl = document.getElementById("board");
    const levelLabelEl = document.getElementById("levelLabel");
    const timerEl = document.getElementById("timer");
    const startOverlay = document.getElementById("startOverlay");
    const btnStartGame = document.getElementById("btnStartGame");
    const resultOverlay = document.getElementById("resultOverlay");
    const resultTitleEl = document.getElementById("resultTitle");
    const resultTextEl = document.getElementById("resultText");
    const btnRetry = document.getElementById("btnRetry");
    const btnNext = document.getElementById("btnNext");

    let currentLevelIndex = 0;
    let flippedCards = [];
    let lockBoard = false;
    let timerId = null;
    let timeLeft = TOTAL_TIME;
    let matchedPairs = 0;
    let totalPairs = 0;
    let gameOver = false;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function chooseRandomItems(items, pairCount) {
      const cloned = [...items];
      shuffle(cloned);
      return cloned.slice(0, pairCount);
    }

    function updateHeader() {
      const level = levels[currentLevelIndex];
      levelLabelEl.textContent = `é—œå¡ ${currentLevelIndex + 1} / ${levels.length}ï¼š${level.name}`;
    }

    function updateTimerDisplay() {
      timerEl.textContent = `å‰©é¤˜æ™‚é–“ï¼š${timeLeft} ç§’`;
    }

    function startTimer() {
      clearInterval(timerId);
      timeLeft = TOTAL_TIME;
      gameOver = false;
      updateTimerDisplay();

      timerId = setInterval(() => {
        timeLeft--;
        if (timeLeft < 0) timeLeft = 0;
        updateTimerDisplay();

        if (timeLeft <= 0) {
          clearInterval(timerId);
          if (!gameOver) {
            handleTimeUp();
          }
        }
      }, 1000);
    }

    function handleTimeUp() {
      gameOver = true;
      lockBoard = true;
      resultTitleEl.textContent = "æ™‚é–“åˆ°";
      resultTextEl.textContent = "å“ˆå“ˆå“ˆå‚»çœ¼";
      btnRetry.style.display = "inline-block";
      btnNext.style.display = "inline-block";
      btnNext.textContent = "é‡æ–°æŒ‘æˆ°ä¸‹ä¸€æ¬¡ï¼Ÿï¼ˆä»åœ¨æœ¬é—œï¼‰";
      resultOverlay.classList.remove("hidden");
    }

    function clearBoard() {
      boardEl.innerHTML = "";
      flippedCards = [];
      matchedPairs = 0;
      totalPairs = 0;
      lockBoard = false;
    }

    function buildBoardForLevel(levelIndex) {
      clearBoard();
      const level = levels[levelIndex];

      // ä¸€é—œå…ˆç”¨ 4 çµ„ç‰Œï¼ˆ8 å¼µï¼‰ï¼Œè² æ“”æ¯”è¼ƒå°
      const PAIRS_PER_LEVEL = 4;
      const selectedItems = chooseRandomItems(level.items, PAIRS_PER_LEVEL);
      totalPairs = selectedItems.length;

      const cardsData = [];
      selectedItems.forEach(item => {
        cardsData.push({ ...item });
        cardsData.push({ ...item });
      });

      shuffle(cardsData);

      cardsData.forEach((item) => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.id = item.id;

        const inner = document.createElement("div");
        inner.className = "card-inner";

        const front = document.createElement("div");
        front.className = "card-front";
        front.textContent = "ï¼Ÿ";

        const back = document.createElement("div");
        back.className = "card-back";

        const emojiSpan = document.createElement("div");
        emojiSpan.className = "emoji";
        emojiSpan.textContent = item.emoji;

        const labelSpan = document.createElement("div");
        labelSpan.className = "label";
        labelSpan.textContent = item.label;

        back.appendChild(emojiSpan);
        back.appendChild(labelSpan);

        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);
        boardEl.appendChild(card);
      });
    }

    function startLevel(levelIndex) {
      currentLevelIndex = levelIndex;
      updateHeader();
      buildBoardForLevel(currentLevelIndex);
      startTimer();
    }

    function onCardClick(event) {
      if (lockBoard) return;
      const card = event.target.closest(".card");
      if (!card || card.classList.contains("flipped") || card.classList.contains("matched")) return;

      flipCard(card);

      flippedCards.push(card);

      if (flippedCards.length === 2) {
        lockBoard = true;
        checkMatch();
      }
    }

    function flipCard(card) {
      card.classList.add("flipped");
    }

    function unflipCard(card) {
      card.classList.remove("flipped");
    }

    function checkMatch() {
      if (flippedCards.length !== 2) return;

      const [cardA, cardB] = flippedCards;
      const isMatch = cardA.dataset.id === cardB.dataset.id;

      if (isMatch) {
        cardA.classList.add("matched", "disabled");
        cardB.classList.add("matched", "disabled");
        matchedPairs++;

        flippedCards = [];
        lockBoard = false;

        if (matchedPairs === totalPairs) {
          handleLevelClear();
        }
      } else {
        setTimeout(() => {
          unflipCard(cardA);
          unflipCard(cardB);
          flippedCards = [];
          lockBoard = false;
        }, 800);
      }
    }

    function handleLevelClear() {
      gameOver = true;
      clearInterval(timerId);

      const level = levels[currentLevelIndex];
      const isLast = currentLevelIndex === levels.length - 1;

      resultTitleEl.textContent = "æ­å–œéé—œ ğŸ‰";
      resultTextEl.textContent = `ä½ å·²ç¶“å®Œæˆã€${level.name}ã€‘é—œå¡ï¼`;

      btnRetry.style.display = "inline-block";

      if (isLast) {
        btnNext.textContent = "å…¨éƒ¨é€šé—œï¼å¾ç¬¬ä¸€é—œå†ç©ä¸€æ¬¡";
      } else {
        btnNext.textContent = "å‰å¾€ä¸‹ä¸€é—œ";
      }
      btnNext.style.display = "inline-block";

      resultOverlay.classList.remove("hidden");
    }

    // ---- äº‹ä»¶ç¶å®š ----

    boardEl.addEventListener("click", onCardClick);

    btnStartGame.addEventListener("click", () => {
      startOverlay.classList.add("hidden");
      startLevel(0);
    });

    btnRetry.addEventListener("click", () => {
      resultOverlay.classList.add("hidden");
      startLevel(currentLevelIndex);
    });

    btnNext.addEventListener("click", () => {
      resultOverlay.classList.add("hidden");
      const isLast = currentLevelIndex === levels.length - 1;
      if (isLast) {
        startLevel(0); // å…¨éƒ¨é€šé—œå¾Œï¼Œå›ç¬¬ä¸€é—œ
      } else {
        startLevel(currentLevelIndex + 1);
      }
    });
  </script>
</body>
</html>
