<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>è¨˜æ†¶åŠ›å¤§è€ƒé©— - å‡ç´šç‰ˆ</title>
  <style>
    :root {
      --primary-color: #4f46e5;
      --bg-color: #f0f2f5;
      --card-bg: #fff;
      --card-back: linear-gradient(135deg, #6366f1, #4f46e5);
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      background: var(--bg-color);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden; /* é˜²æ­¢æ•´å€‹é é¢å½ˆæ€§æ²å‹• */
    }

    /* é ‚éƒ¨å›ºå®šè³‡è¨Šæ¬„ */
    header {
      background: #fff;
      padding: 12px 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      z-index: 10;
      flex-shrink: 0;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    h1 {
      margin: 0;
      font-size: 1.2rem;
      color: #333;
    }

    .level-badge {
      background: #e0e7ff;
      color: var(--primary-color);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: bold;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
      font-weight: 600;
      color: #555;
    }

    .timer.urgent {
      color: #dc2626;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    /* éŠæˆ²ä¸»å€åŸŸ (å¯æ²å‹•) */
    main {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* å…§å®¹å°‘æ™‚é ä¸Šï¼Œå¤šæ™‚æ²å‹• */
    }

    .board {
      display: grid;
      /* æ‰‹æ©Ÿç›´å¼å„ªåŒ–ï¼šè‡ªå‹•å¡«æ»¿ï¼Œæœ€å°å¯¬åº¦è¨­ç‚ºé©åˆæ‰‹æŒ‡çš„å¤§å° */
      grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
      gap: 10px;
      width: 100%;
      max-width: 600px;
      padding-bottom: 40px; /* åº•éƒ¨ç•™ç™½ */
    }

    /* å¡ç‰‡æ¨£å¼ */
    .card {
      aspect-ratio: 3 / 4; /* ä¿æŒé•·å¯¬æ¯” */
      position: relative;
      perspective: 1000px;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      position: relative;
      transition: transform 0.4s;
      transform-style: preserve-3d;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card.matched .card-inner {
      transform: rotateY(180deg);
      box-shadow: 0 0 15px #4ade80; /* é…å°æˆåŠŸçš„ç™¼å…‰æ•ˆæœ */
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      font-weight: bold;
    }

    /* å¡ç‰‡èƒŒé¢ (æœªç¿»é–‹) */
    .card-front {
      background: var(--card-back);
      color: #fff;
      font-size: 2rem;
    }
    
    .card-front::after {
      content: "?";
    }

    /* å¡ç‰‡æ­£é¢ (ç¿»é–‹å¾Œ) */
    .card-back {
      background: #fff;
      transform: rotateY(180deg);
      border: 2px solid #e5e7eb;
    }

    .emoji {
      font-size: 2rem;
      line-height: 1;
      margin-bottom: 4px;
    }

    .label {
      font-size: 0.8rem;
      color: #333;
      text-align: center;
      line-height: 1.2;
    }

    /* æ‰‹æ©Ÿç•«é¢é©é… */
    @media (max-width: 400px) {
      .board {
        grid-template-columns: repeat(4, 1fr); /* å¼·åˆ¶å››æ’ï¼Œé¿å…å¤ªå°‘ */
        gap: 8px;
      }
      .emoji { font-size: 1.5rem; }
      .label { font-size: 0.7rem; }
    }

    /* é®ç½©å±¤ */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(4px);
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      background: #fff;
      padding: 30px 20px;
      border-radius: 20px;
      text-align: center;
      width: 100%;
      max-width: 320px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      transform: scale(0.9);
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .overlay.active .modal {
      transform: scale(1);
    }

    .modal h2 {
      margin: 0 0 10px;
      font-size: 1.8rem;
      color: #111;
    }

    .modal p {
      color: #666;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 12px;
      transition: transform 0.1s;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background: var(--primary-color);
      color: #fff;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

  </style>
</head>
<body>

  <header>
    <div class="header-row">
      <h1>è¨˜æ†¶åŠ›å¤§è€ƒé©—</h1>
      <div id="levelBadge" class="level-badge">Lv.1</div>
    </div>
    <div class="status-bar">
      <span id="categoryName">é¡åˆ¥ï¼šæ°´æœ</span>
      <span id="timerText">30s</span>
    </div>
  </header>

  <main>
    <div id="board" class="board"></div>
  </main>

  <!-- éŠæˆ²é–‹å§‹ / éé—œ / å¤±æ•— é®ç½© -->
  <div id="overlay" class="overlay active">
    <div class="modal">
      <h2 id="modalTitle">æº–å‚™å¥½äº†å—ï¼Ÿ</h2>
      <p id="modalDesc">
        å…±æœ‰ 5 å€‹é—œå¡ã€‚<br>
        æ¯é—œå¡ç‰‡æœƒè®Šå¤šï¼Œæ™‚é–“æœƒåŠ é•·ï¼<br>
        æ‰‹æ©Ÿç›´æ‹¿ç©èµ·ä¾†æ›´é †æ‰‹ã€‚
      </p>
      <button id="btnAction" class="btn btn-primary">é–‹å§‹æŒ‘æˆ°</button>
      <button id="btnRetry" class="btn btn-secondary" style="display:none;">å†è©¦ä¸€æ¬¡</button>
    </div>
  </div>

  <script>
    /* 
      å„ªåŒ–é‡é»ï¼š
      1. è³‡æ–™åº«æ“´å……ï¼šç¢ºä¿é«˜ç­‰ç´šæœ‰è¶³å¤ çš„ä¸é‡è¤‡åœ–æ¡ˆã€‚
      2. å‹•æ…‹è¨ˆç®—ï¼šæ¯é—œå¢åŠ  2 å° (4å¼µ) å¡ç‰‡ï¼Œæ™‚é–“å¢åŠ  5 ç§’ã€‚
    */
    const BASE_PAIRS = 4; // ç¬¬1é—œ 4å° (8å¼µ)
    const PAIRS_INC = 2;  // æ¯é—œåŠ  2å° (4å¼µ)
    const BASE_TIME = 30; // ç¬¬1é—œ 30ç§’
    const TIME_INC = 5;   // æ¯é—œåŠ  5ç§’

    const levelsData = [
      {
        name: "æ°´æœå¸‚å ´",
        items: [
          { id: "apple", emoji: "ğŸ", label: "è˜‹æœ" },
          { id: "banana", emoji: "ğŸŒ", label: "é¦™è•‰" },
          { id: "grape", emoji: "ğŸ‡", label: "è‘¡è„" },
          { id: "orange", emoji: "ğŸŠ", label: "æ©˜å­" },
          { id: "water", emoji: "ğŸ‰", label: "è¥¿ç“œ" },
          { id: "pine", emoji: "ğŸ", label: "é³³æ¢¨" },
          { id: "straw", emoji: "ğŸ“", label: "è‰è“" },
          { id: "kiwi", emoji: "ğŸ¥", label: "å¥‡ç•°æœ" },
          { id: "peach", emoji: "ğŸ‘", label: "æ¡ƒå­" },
          { id: "cherry", emoji: "ğŸ’", label: "æ«»æ¡ƒ" },
          { id: "lemon", emoji: "ğŸ‹", label: "æª¸æª¬" },
          { id: "pear", emoji: "ğŸ", label: "æ´‹æ¢¨" },
          { id: "coco", emoji: "ğŸ¥¥", label: "æ¤°å­" },
          { id: "mango", emoji: "ğŸ¥­", label: "èŠ’æœ" }
        ]
      },
      {
        name: "ç¾å‘³é£Ÿç‰©",
        items: [
          { id: "burger", emoji: "ğŸ”", label: "æ¼¢å ¡" },
          { id: "pizza", emoji: "ğŸ•", label: "æŠ«è–©" },
          { id: "sushi", emoji: "ğŸ£", label: "å£½å¸" },
          { id: "noodle", emoji: "ğŸœ", label: "æ‹‰éºµ" },
          { id: "cake", emoji: "ğŸ°", label: "è›‹ç³•" },
          { id: "fries", emoji: "ğŸŸ", label: "è–¯æ¢" },
          { id: "hotdog", emoji: "ğŸŒ­", label: "ç†±ç‹—" },
          { id: "popcorn", emoji: "ğŸ¿", label: "çˆ†ç±³èŠ±" },
          { id: "donut", emoji: "ğŸ©", label: "ç”œç”œåœˆ" },
          { id: "cookie", emoji: "ğŸª", label: "é¤…ä¹¾" },
          { id: "choco", emoji: "ğŸ«", label: "å·§å…‹åŠ›" },
          { id: "icecream", emoji: "ğŸ¦", label: "å†°æ·‡æ·‹" },
          { id: "beer", emoji: "ğŸº", label: "å•¤é…’" },
          { id: "rice", emoji: "ğŸ™", label: "é£¯ç³°" }
        ]
      },
      {
        name: "å¯æ„›å‹•ç‰©",
        items: [
          { id: "dog", emoji: "ğŸ¶", label: "å°ç‹—" },
          { id: "cat", emoji: "ğŸ±", label: "å°è²“" },
          { id: "mouse", emoji: "ğŸ­", label: "è€é¼ " },
          { id: "hamster", emoji: "ğŸ¹", label: "å€‰é¼ " },
          { id: "rabbit", emoji: "ğŸ°", label: "å…”å­" },
          { id: "fox", emoji: "ğŸ¦Š", label: "ç‹ç‹¸" },
          { id: "bear", emoji: "ğŸ»", label: "ç†Š" },
          { id: "panda", emoji: "ğŸ¼", label: "ç†Šè²“" },
          { id: "koala", emoji: "ğŸ¨", label: "ç„¡å°¾ç†Š" },
          { id: "tiger", emoji: "ğŸ¯", label: "è€è™" },
          { id: "lion", emoji: "ğŸ¦", label: "ç…å­" },
          { id: "cow", emoji: "ğŸ®", label: "ä¹³ç‰›" },
          { id: "pig", emoji: "ğŸ·", label: "å°è±¬" },
          { id: "frog", emoji: "ğŸ¸", label: "é’è›™" }
        ]
      },
      {
        name: "äº¤é€šå·¥å…·",
        items: [
          { id: "car", emoji: "ğŸš—", label: "æ±½è»Š" },
          { id: "taxi", emoji: "ğŸš•", label: "è¨ˆç¨‹è»Š" },
          { id: "bus", emoji: "ğŸšŒ", label: "å…¬è»Š" },
          { id: "police", emoji: "ğŸš“", label: "è­¦è»Š" },
          { id: "ambulance", emoji: "ğŸš‘", label: "æ•‘è­·è»Š" },
          { id: "fire", emoji: "ğŸš’", label: "æ¶ˆé˜²è»Š" },
          { id: "bike", emoji: "ğŸš²", label: "è…³è¸è»Š" },
          { id: "train", emoji: "ğŸš„", label: "é«˜éµ" },
          { id: "plane", emoji: "âœˆï¸", label: "é£›æ©Ÿ" },
          { id: "rocket", emoji: "ğŸš€", label: "ç«ç®­" },
          { id: "boat", emoji: "ğŸš¢", label: "è¼ªèˆ¹" },
          { id: "ufo", emoji: "ğŸ›¸", label: "é£›ç¢Ÿ" },
          { id: "truck", emoji: "ğŸšš", label: "å¡è»Š" },
          { id: "motor", emoji: "ğŸ›µ", label: "æ©Ÿè»Š" }
        ]
      },
      {
        name: "å¯¶å¯å¤¢å¤§å¸«",
        items: [
          { id: "pika", emoji: "âš¡", label: "çš®å¡ä¸˜" },
          { id: "ball", emoji: "ğŸ”´", label: "å¯¶è²çƒ" },
          { id: "fire", emoji: "ğŸ”¥", label: "å°ç«é¾" },
          { id: "water", emoji: "ğŸ’§", label: "å‚‘å°¼é¾œ" },
          { id: "grass", emoji: "ğŸƒ", label: "å¦™è›™" },
          { id: "sleep", emoji: "ğŸ’¤", label: "å¡æ¯”ç¸" },
          { id: "psy", emoji: "ğŸ˜µ", label: "å¯é”é´¨" },
          { id: "star", emoji: "â­", label: "æµ·æ˜Ÿæ˜Ÿ" },
          { id: "ghost", emoji: "ğŸ‘»", label: "è€¿é¬¼" },
          { id: "drag", emoji: "ğŸ²", label: "å¿«é¾" },
          { id: "eevee", emoji: "ğŸ¦Š", label: "ä¼Šå¸ƒ" },
          { id: "mew", emoji: "ğŸ±", label: "å¤¢å¹»" },
          { id: "bird", emoji: "ğŸ¦…", label: "æ¯”é›•" },
          { id: "bug", emoji: "ğŸ›", label: "ç¶ æ¯›èŸ²" }
        ]
      }
    ];

    // ç°¡å–®çš„éŸ³æ•ˆ (Beep)
    const playFlipSound = () => {
      // é€™è£¡å¯ä»¥åŠ å…¥çœŸå¯¦éŸ³æ•ˆï¼Œç‚ºæ±‚ç°¡æ½”çœç•¥ï¼Œä¿ç•™è¦–è¦ºå›é¥‹
    };

    let currentLevelIdx = 0;
    let timerInterval = null;
    let timeLeft = 0;
    let isLocked = false;
    let flippedCards = [];
    let matchedCount = 0;
    let targetPairs = 0;

    // DOM Elements
    const boardEl = document.getElementById("board");
    const levelBadgeEl = document.getElementById("levelBadge");
    const categoryNameEl = document.getElementById("categoryName");
    const timerTextEl = document.getElementById("timerText");
    const overlayEl = document.getElementById("overlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalDesc = document.getElementById("modalDesc");
    const btnAction = document.getElementById("btnAction");
    const btnRetry = document.getElementById("btnRetry");

    function shuffle(array) {
      let currentIndex = array.length, randomIndex;
      while (currentIndex != 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
      }
      return array;
    }

    function initGame(levelIndex) {
      // 1. è¨­å®šåƒæ•¸
      currentLevelIdx = levelIndex;
      const levelData = levelsData[levelIndex];
      
      // è¨ˆç®—æœ¬é—œéœ€è¦çš„å°æ•¸ï¼šåŸºç¤4 + (é—œå¡æ•¸ * 2) => 4, 6, 8, 10, 12
      targetPairs = BASE_PAIRS + (levelIndex * PAIRS_INC);
      // è¨ˆç®—æœ¬é—œæ™‚é–“ï¼šåŸºç¤30 + (é—œå¡æ•¸ * 5) => 30, 35, 40...
      timeLeft = BASE_TIME + (levelIndex * TIME_INC);

      matchedCount = 0;
      flippedCards = [];
      isLocked = false;
      
      // 2. æ›´æ–° UI
      levelBadgeEl.textContent = `Lv.${levelIndex + 1}`;
      categoryNameEl.textContent = levelData.name;
      timerTextEl.textContent = `${timeLeft}s`;
      timerTextEl.classList.remove("urgent");
      boardEl.innerHTML = "";

      // 3. æº–å‚™å¡ç‰‡
      // å¾è©²é¡åˆ¥ä¸­éš¨æ©ŸæŒ‘é¸ targetPairs å€‹åœ–æ¡ˆ
      const pool = shuffle([...levelData.items]).slice(0, targetPairs);
      // è¤‡è£½æˆå…©ä»½ä¸¦æ‰“äº‚
      const deck = shuffle([...pool, ...pool]);

      // 4. ç”Ÿæˆ HTML
      deck.forEach(item => {
        const card = document.createElement("div");
        card.classList.add("card");
        card.dataset.id = item.id;
        
        card.innerHTML = `
          <div class="card-inner">
            <div class="card-face card-front"></div>
            <div class="card-face card-back">
              <div class="emoji">${item.emoji}</div>
              <div class="label">${item.label}</div>
            </div>
          </div>
        `;

        card.addEventListener("click", () => flipCard(card));
        boardEl.appendChild(card);
      });

      // 5. é–‹å§‹è¨ˆæ™‚
      startTimer();
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        timerTextEl.textContent = `${timeLeft}s`;
        
        if (timeLeft <= 5) {
          timerTextEl.classList.add("urgent");
        }

        if (timeLeft <= 0) {
          gameOver();
        }
      }, 1000);
    }

    function flipCard(card) {
      if (isLocked) return;
      if (card.classList.contains("flipped") || card.classList.contains("matched")) return;

      playFlipSound();
      card.classList.add("flipped");
      flippedCards.push(card);

      if (flippedCards.length === 2) {
        checkMatch();
      }
    }

    function checkMatch() {
      isLocked = true;
      const [card1, card2] = flippedCards;
      const match = card1.dataset.id === card2.dataset.id;

      if (match) {
        card1.classList.add("matched");
        card2.classList.add("matched");
        matchedCount++;
        flippedCards = [];
        isLocked = false;

        if (matchedCount === targetPairs) {
          levelComplete();
        }
      } else {
        setTimeout(() => {
          card1.classList.remove("flipped");
          card2.classList.remove("flipped");
          flippedCards = [];
          isLocked = false;
        }, 800);
      }
    }

    function gameOver() {
      clearInterval(timerInterval);
      showModal(
        "æ™‚é–“åˆ°ï¼", 
        "å“ˆå“ˆå“ˆå‚»çœ¼ï¼æ™‚é–“ä¸å¤ ç”¨äº†ã€‚<br>åˆ¥ç°å¿ƒï¼Œå†è©¦ä¸€æ¬¡å§ï¼",
        "é‡ç©æœ¬é—œ",
        true
      );
    }

    function levelComplete() {
      clearInterval(timerInterval);
      
      const isLastLevel = currentLevelIdx === levelsData.length - 1;

      if (isLastLevel) {
        showModal(
          "å…¨ç ´æ­å–œï¼ğŸ‰", 
          "å¤ªå¼·äº†ï¼ä½ å·²ç¶“å®Œæˆäº†æ‰€æœ‰é—œå¡ã€‚<br>ä½ çš„è¨˜æ†¶åŠ›ç°¡ç›´æ˜¯é›»è…¦ç­‰ç´šï¼",
          "å¾é ­å†ç©",
          false
        );
        currentLevelIdx = -1; // é‡ç½®
      } else {
        const nextLevel = currentLevelIdx + 1;
        const nextPairs = BASE_PAIRS + (nextLevel * PAIRS_INC);
        const nextTime = BASE_TIME + (nextLevel * TIME_INC);
        
        showModal(
          "é—œå¡å®Œæˆï¼", 
          `ä¸‹ä¸€é—œå¡ç‰‡è®Šç‚º ${nextPairs * 2} å¼µ<br>é™æ™‚ ${nextTime} ç§’ï¼Œæº–å‚™å¥½äº†å—ï¼Ÿ`,
          "é€²å…¥ä¸‹ä¸€é—œ",
          false
        );
      }
    }

    function showModal(title, desc, btnText, isRetry) {
      modalTitle.textContent = title;
      modalDesc.innerHTML = desc;
      btnAction.textContent = btnText;
      
      // è¨­å®šæŒ‰éˆ•è¡Œç‚º
      btnAction.onclick = () => {
        overlayEl.classList.remove("active");
        if (isRetry) {
          initGame(currentLevelIdx);
        } else {
          // å¦‚æœå…¨éƒ¨é€šé—œè¢«é‡ç½®ç‚º-1ï¼Œé€™è£¡åŠ 1è®Šå›0
          initGame(currentLevelIdx + 1);
        }
      };

      // é¡¯ç¤ºé®ç½©
      overlayEl.classList.add("active");
    }

    // åˆå§‹ç¶å®š
    btnAction.onclick = () => {
      overlayEl.classList.remove("active");
      initGame(0);
    };

  </script>
</body>
</html>